/**
    Copyright 2014-2015 Amazon.com, Inc. or its affiliates. All Rights Reserved.

    Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at

        http://aws.amazon.com/apache2.0/

    or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
 */
package com.amazon.customskill;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Random;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.stream.IntStream;

import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.amazon.speech.json.SpeechletRequestEnvelope;
import com.amazon.speech.slu.Intent;
import com.amazon.speech.speechlet.IntentRequest;
import com.amazon.speech.speechlet.LaunchRequest;
import com.amazon.speech.speechlet.SessionEndedRequest;
import com.amazon.speech.speechlet.SessionStartedRequest;
import com.amazon.speech.speechlet.SpeechletResponse;
import com.amazon.speech.speechlet.SpeechletV2;
import com.amazon.speech.ui.PlainTextOutputSpeech;
import com.amazon.speech.ui.Reprompt;
import com.amazon.speech.ui.SsmlOutputSpeech;


/*
 * This class is the actual skill. Here you receive the input and have to produce the speech output. 
 */
public class AlexaSkillSpeechlet
implements SpeechletV2
{
	static Logger logger = LoggerFactory.getLogger(AlexaSkillSpeechlet.class);

	public static String userRequest;

	private static int sum;
	private static String answerOption1 = "";
	private static String answerOption2 = "";
	private static boolean publikumUsed;
	private static boolean fiftyfiftyUsed;
	private static String question = "";
	private static String correctAnswer = "";
	private static enum RecognitionState {Answer, YesNo};
	private RecognitionState recState;
	private static enum UserIntent {Yes, No, A, B, C, D, Publikum, FiftyFifty};
	UserIntent ourUserIntent;

	static String einleitung1 = "It was a dark and stormy night, when you and your assistant Watson were invited to Furbish Manor. The rain hammered on the roof of the cab you were using to get there. You stand in front of the dark, iron gate and wait that somebody comes to let you in. The wind is cold and you have to wait a moment in this unpleasant place. Watson looks at you: “Do you remember how we normaly solve a case, or should i explain to you how we do this?";
	static String tutorial1 = "Its really not that complicated: We walk around a house and ask the people we meet the questions we want to ask them. They answer. Most often they have seen something or have not seen something in a while. You should ask them for their alibis and who can prove them. Maybe somebody is lying, so you should listen carefully. Did you understand that?";
	static String tutorial2 = "If we enter the room you will get a general description of what is in it. You can look at some things, if you want to learn more about them. Should i repeat what i just said?";
	static String tutorial3 = "If you forget anything that you have found you can always ask me. Just say “Watson” and i will be there. I can give you a short summary and some more tipps. Did you understand me? The rain is so loud, i can understand if you say, that you did not.";
	static String einleitung2 = "After a few minutes finally somebody opens the gate to let you in. Together you walk the street up the hill until you come to the entry. The door opens and you enter.";
	
	static String exampleq = "The main things you need to find out to solve the mystery successfully are where the people have been when the crime has happened, if they have any suspicion who could have done such terrible things, if something did seem weird to them lately. Furthermore, you should ask the persons about their relationships with the deceased Lord and maybe if they knew some things about the other persons living there and if they could have done the crime.Do you want to listen to a few example questions and if so, which?";
	static String exampleqwhich = "Choose to what you want to hear an example question: Where, relationship, weirdness, suspicion, other persons.";
	static String question1 = "Where have you been when the crime was committed?";
	static String question2 = "What was your relationship with the deceased Lord?";
	static String question3 = "Did something seem weird to you lately?";
	static String question4 = "Do you have any suspicion?";
	static String question5 = "Could you imagine of of the others committing such a crime?";
	static String exampleqmore = "Do you want to listen to further example questions?";
	static String questionsmore = "Anything else?";
	static String questionask = "What would you like to ask? If you need some example-questions you can ask me for some";
	
	static String solvequ = "You think you solved it? Have you asked enough people? Looked at every clue?";
	static String solvewho = "I am impressed. Who do you think is the murderer?";
	static String solveright = "You made it. You found the murderer of Lord Furbish. It was indeed the gardener. Let's see what he has to say.";
	static String solvemono = "My poor sweet daughter, the maid, had an affair with Lord Furbish. The Lord tarnished her honor and their relationship was doomed from the start. I took the sword and threatened him so he would leave my daughter in peace. Then I tripped over this damned carpet. The sword pierced his chest and he was dead within seconds."; 
	static String solvewrong = "No, it seems it was not this witness either.";
	static String solveanothertry = "Do you want another try?";
	static String solveescape = "And even worse: I fear that the real murderer has escaped.";
	
	static String watson = "How can i help you?I can give you a wrap up of all we know so far. I can also tell you some vocabulary you do not know.";
	static String watsonzsm = "Ok, here is what we know so far."+ Jameszsmfassung + Gardnerzsmfassung + Cookzsmfassung + Ladyzsmfassung + Maidzsmfassung + Childzsmfassung + "Thats it. Do you want to hear it again?";
	static String watsonmore = "Can i help you some more?";
	
	static String entrbeschr = "The Entrance Hall is dimly lit and feels calm and empty. The eerie silence is only disturbed by the echo of your steps on the cold marble floor and the big doors closing behind you. You see a grande staircase leading up to several doors, a door to the lounge, the kitchen, the bedchamber, the library, the garden and the servants wing. Next to the staircase are two knights armor on either side. A butler is standing next to one of the doors.";
	static String entrwwyd = "What do you want to do in the entrance hall? Would you like to speak to the witness, search the room or leave the room?";
	static String entrdetail = "You take a closer look around. Nothing seems unusual to you on the first glance. Everything is perfectly cleaned and there are no traces of an intruder. The murderer must be someone within the house. Then you see it. One of the knights armors positioned next to the staircase is missing it's sword, which could be a murder weapon.";
	static String entrwhroom = "Where do you want to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";
	
	static String librbeschr = "WOW! That's a library like it is said in the books. Like bells library from beauty and the beast. High walls and shelves filled with books everywhere around you.  There are even these movable ladders so you can get to the higher shelves that you know from those movies. Also the smell is as you always imagined it. There are comfortable armchairs that invite you to linger and in the background ist soft music playing. There's no one to be seen here far and wide... But there's something moving back there, isn't it? Ahh, a cat! It looks sweet and fluffy, do you want to pet it?";
	static String librwwyd = "What do you want to do in the library? Would you like to search the room, pet the cat or leave the room?";
	static String librdetail = "You see that the cat was treated better than the servants. It has a red bow of silk tied around it's neck and the porcelain bowls in the corner are full of fresh meat and water. Someone must tend to it heartwarmingly.";
	static String librcat = "It meows.";
	static String librwhroom = "Where do you wnat to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";
	
	static String gardbeschr = "You enter the garden and can hardly believe your eyes. A large weeping willow surrounded by the most beautiful flowerbeds you have ever seen is in the center of the large field. An old broken bench looks grim underneath the willow. A small pond next to the tree reflects the silver moonlight. Fruit trees frame a narrow path, which you follow down to a greenhouse. Bent over a vegetable patch, you see a gardener, an old man with soft friendly features. When he notices you, he turns around and smiles encouragingly at you.";
	static String gardwwyd = "What do you want to do in the Garden? Would you like to speak to the witness, search the room or leave the room?";
	static String garddetail = "You see that the Gardner's forehead is covered in sweat, but you aren't sure whether it's from the hard work whether he is hiding something. ";
	static String gardwhroom = "Where do you wnat to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";

	static String servbedbeschr = "You've come through the servants' wing and you see an open door, you look in. Here, compared to the hallway, it looks really nice and cosy, despite the uncomfortable walls surrounding the room. There is a small bed, a chest of drawers with a mirror and a narrow closet in the room. A girl is sitting on the stool in front of the chest of drawers, you think that it can only be the maid. She holds a photo in her hand. When she notices you, she quickly lets it disappear, but you catch a last glimpse of it. It's a photo of the deceased lord with the maid...What was the connection between these two? She looks frightened and at the same time infinitely sad. You start asking her a few questions. ";
	static String servbedwwyd = "What do you want to do in the servants bedroom? Would you like to speak to the witness, search the room or leave the room?";
	static String servbeddetail = "The girl is clearly madly in love with the Lord. Was the relationship one sided or was he involved too? She looks fairly innocent, you don't think that she could've commited such a gruesome murder. Maybe an act of jealousy?";
	static String servbedwhroom = "Where do you want to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";
	
	static String kitchbeschr = "You're standing in the heart of the house now, here's the kitchen. It smells and bubbles everywhere. It scents like freshly cooked food. On the wall are pots and pans hanging and you hear dishes clattering. You look to the right and see a large table full of delicacies: Sliced fruit, vegetables, various sauces and bowls with meat and potatoes and much more. Next to them are a lot of fresh herbs. The cook also stands here and tries to place more food on the table. ";
	static String kitchenwwyd = "What do you want to do in the kitchen? Would you like to speak to the witness, search the room or leave the room?";
	static String kitchdetail = "You look around and notice that the table is so full of food that there isn't a single empty square inch of free space. This amount would take hours, maybe even days to cook. You also notice that several knifes are missing from the knife block.";
	static String kitchwhroom = "Where do you wnat to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";
	
	static String servwingbeschr = "You get into a dark corridor with bare walls, a single flickering light bulb hangs from the ceiling. The wooden planks under your feet creak and the air is cold and somehow damp. This is by far the creepiest room in the castle. But you hear another sound, what is that? It's the kitchen boy playing on the floor. He has some wooden toys that have the best behind them. But he looks quite happy the way he sits there. When he sees you he is frightened, but the creaking planks should have announced you? Strange. He crouches down a bit, you calm him down and ask why he is afraid...";
	static String servwingwwyd = "What do you want to do in the servants wing? Would you like to speak to the witness, search the room or leave the room?";
	static String servwingdetail = "You don't notice anything exceptional in corridor. It's cold and damp like every other servant corridor. People don't care whether servants are comfortable or not.";
	static String servwingwhroom = "Where do you wnat to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";
	
	static String bedrbeschr = "You open the door into a luxurious Bedroom. Floorlength Windows almost hidden beneath heavy velvet curtains shine silver light into the spacious room which is full of handcarved furnishings. Detailed paintings in golden Frames decorate every inch of the walls and a big carpet covers the finely polished parquet. An elderly Lady strutts absently through the room.One expensive garment after another disappears into the already empty closet of the recently deceased Lord. When she notices you, she looks frightened for a split second though she catches herself quickly and starts sobbing without shedding a tear. She grabs your arm and looks out of the window, all in one dramatic gesture.";
	static String bedrwwyd = "What do you want to do in the Bed chamber? Ask the withness, leave the room or solve?";
	static String bedrdetail = "You see that the Lord's mother, the lady, isnt as destressed with the death of her son as she is trying to convey. She has already cleaned out every single piece of her sons clothing from his bedroom.";
	static String bedrwhroom = "In which room do you want to go";
	
	static String loungbeschr = "As you enter the scene of the crime thunder disturbs the gloomy night. You see a fireplace which fire has gone out a long time ago. Two leather armchairs and a small table opposite of the fireplace seem to have been pushed aside. Expensive liquor that once was on the table now was spilled all over the carpet. The body of the deceased is laying behind the armchair, as if he tried to create distance between him and his murderer. His eyes are still wide-open in fear. His elegant clothing is now drenched in his own blood coming out of a single stab wound in the middle of his chest. You close his eyes.";
	static String loungwwyd = "What do you want to do in the Lounge? Would you like to search the room or leave the room?";
	static String loungdetail = "When you take a closer look you see that one corner of the carpet is folded under itself. Someone could easily trip over it. ";
	static String loungwhroom = "Where do you wnat to go: The kitchen? The lounge? The servants wing? The Servants bedroom? The bedchamber or the library?";
	
	static String jamesbeschr = "The Butler of the house is a grim looking lanky man with pronounced eyebrows and a hooked nose reaching almost down to his lips. He is wearing a worn down, but meticulously cleaned suit.";
	static String jameswhere = "Polishing silver cutlery with the Maid. Why are you asking? Do I seem like a murderer. I have been working here since a long, long time. I’m becoming older, don’t want to risk or lose my job, understand detective?";
	static String jamesrelation = "Young ‘n stupid man, you know. Had a lot to learn, lately. We Didn’t really have a connection. I was just doing my job here, man.";
	static String jamesweird = "A lot of things seem weird these days, don’t  you think? The Old Lady has acted strangely… Bought a lot of stuff. Go ask her and leave me alone.";
	static String jamessusp = "Detective, I’m not gonna tell you the secrets of this house. Never have, never will.";
	static String jamesothers = "I was with the maid. Don’t know anything about the others, mind my own business, you know.";
	
	static String childbeschr = "A little boy, at the age of 6. He has brown hair and on his shirt there is a red blot, possibly cherry sauce. He is the son of the cook";
	static String child1 = "";
	static String child2 = "";
	static String child3 = "";
	
	static String cookbeschr = "The cook is probably the friendliest and most loving person in the whole house. She cares for everyone and makes sure everyone gets enough to eat. She also stands for the mistakes of others. She had a very good relationship with the Lord, although the mother hates this.";
	static String cookwhere = "Right here Sir. The Lady wanted to have an extravagant supper. I was cooking, baking and preparing all day for it. I’m still not ready Sir.";
	static String cookrelation = "Didn’t really have any. I’m in the kitchen or in the servants wing most of the time. I don’t have enough time for chitchat most of the time. And they treat us as what we are, servants.";
	static String cookweird = "Not that i noticed of. I am focussed on my craft most of the time though.";
	static String cooksusp = "Not that i can think of. The Lord payed and treated us well. We are lucky to be here Sir.";
	static String cookothers = "I know that my boy was playing in the servant wings. I’ve heard him pretending to be the prince.";
	
	static String gardenerbeschr = "The gardener is a very simple-minded man. He seems to have been doing his job well for many years. He is said to have been in love with the lady many years ago. Well, in any case he loves his daughter, the maid, more than anything and would probably do anything for her";
	static String gardenerwhere = "I was talking to my daughter, she is the wonderful maid that’s working for the Lord himself. Marvelous girl, if you ask me. Only the best in her mind for everyone. I think she deserved better than being a  maid. I told her to go to the East of the Country and get a better life. But she did not agree with me. I’m sorry, that hasn’t anything to do with your question. ";
	static String gardenerrelation = "I’m only the Gardener, working so that my daughter could have a better life. I’m a gentleman in contrast to the lord, but that’s on a different page. We had a decent relationship. Not to close, but decent.";
	static String gardeneerweird = "Not at all! It’s like it has ever been around here. But if you want to ask a strange man around here, go to the Butler, James. Ask him the questions...It’s such a tragedy what happened. I hope you find the right man, detective.";
	static String gardenersusp = "James didn’t really like him, but he hasn’t had enemies, so far. I guess everyone liked him but no one knew him for real.";
	static String gardenerothers = "I know my daughter was with me, can’t tell you more. I am sorry for that detective.";
	
	static String ladybeschr = "The old lady is the mother of the late lord. She is an old woman but very well groomed with lots of make-up and a striking hairstyle. She wears a lot of jewellery and excessive embelishments.";
	static String ladywhere = "I was in the garden, having a walk and relaxing beneath the willow. I had wanted to try out my new walking dress.";
	static String ladyrelation = "He was my only child. My baby. His father, my deceased husband, poisoned him with his thoughts of equality. Wanted to be one of the commoners. Said that nobody should have servants. I hoped that he would come to reason. He should’ve listened to me! Commoners will bite of your arm if you offer them a hand. Now he is dead... Well at least I can use his life insurance money to remarry and bury my sorrow in diamonds.";
	static String ladyweird = "The shipment of the dresses i bought last week haven’t arrived yet. I need to write them a stern letter if they don’t arrive soon.";
	static String ladysusp = "Surely it was one of the dirty servants. He was way too nice to them, paid them way too much too. They probably wanted to extort them for even more money.";
	static String ladyothers = "I know that the gardner wasn’t in the garden. He get’s me some fruit of the trees usually, but I didn’t see him today.";
	
	static String maidbeschr = "The maid is a shy, young and innocent girl who is satisfied with little. She is not conspicuous but if you look at her for a long time you will notice that she is beautiful. As a prince, you could easily fall for that, don't you think?";
	static String maidwhere = "I was polishing the silver cutlery together with james all day long. He can tell that we did that too! Don’t you dare think I was the murderer of my beloved Lord. ";
	static String maidrelation = "I...We… We were good friends. We grew up together, i guess. He is one of the most important persons I have...I had.";
	static String maidweird = "I don't know.. I don't know.. I’m sorry I have to go now…";
	static String maidsusp = "I can not think of one person in this whole house who would do this, ever! I mean, James did not really like him but he was polishing the silver cutlery with me, so he’s out. He wasn’t best friends with my father but he would have never done it! NEVER!";
	static String maidothers = "I only know me and James were polishing… The cook was cooking all day, for sure. Otherwise I don’t know what everyone does the whole day, why should I?";
	
	
	private String buildString(String msg, String replacement1, String replacement2) {
		return msg.replace("{replacement}", replacement1).replace("{replacement2}", replacement2);
	}





	@Override
	public void onSessionStarted(SpeechletRequestEnvelope<SessionStartedRequest> requestEnvelope)
	{
		logger.info("Alexa session begins");
		publikumUsed = false;
		fiftyfiftyUsed = false;
		sum = 0;
		recState = RecognitionState.Answer;
		
		String jzsm1 ="";
		String jzsm2 = "";
		String jzsm3 = "";
		String jzsm4 = "";
		String jzsm5 = "";
		String jzsm= jzsm1+jzsm2+jzsm3+jzsm4+jzsm5;
		
		String lzsm1 = "";
		String lzsm2 = "";
		String lzsm3 = "";
		String lzsm4 = "";
		String lzsm5 = "";
		String lzsm = lzsm1+lzsm2+lzsm3+lzsm4+lzsm5;
		
		String czsm1 = "";
		String czsm2 = "";
		String czsm3 = "";
		String czsm4 = "";
		String czsm5 = "";
		String czsm = czsm1+czsm2+czsm3+czsm4+czsm5;
		
		String kzsm1 = "";
		String kzsm2 = "";
		String kzsm3 = "";
		String kzsm4 = "";
		String kzsm5 = "";
		String kzsm = kzsm1+kzsm2+kzsm3+kzsm4+kzsm5;
		
		String mzsm1 = "";
		String mzsm2 = "";
		String mzsm3 = "";
		String mzsm4 = "";
		String mzsm5 = "";
		String mzsm = mzsm1+mzsm2+mzsm3+mzsm4+mzsm5;
		
		String gzsm1 = "";
		String gzsm2 = "";
		String gzsm3 = "";
		String gzsm4 = "";
		String gzsm5 = "";
		String gzsm = gzsm1+gzsm2+gzsm3+gzsm4+gzsm5;
	}

	@Override
	public SpeechletResponse onLaunch(SpeechletRequestEnvelope<LaunchRequest> requestEnvelope)
	{
		startgame();
		return askUserResponse(welcomeMsg+" "+question);
	}

	private void startgame() {
		//spiel
		
		}
	}

	@Override
	public SpeechletResponse onIntent(SpeechletRequestEnvelope<IntentRequest> requestEnvelope)
	{
		IntentRequest request = requestEnvelope.getRequest();
		Intent intent = request.getIntent();
		userRequest = intent.getSlot("anything").getValue();
		logger.info("Received following text: [" + userRequest + "]");
		logger.info("recState is [" + recState + "]");
		SpeechletResponse resp = null;
		switch (recState) {
		case Answer: resp = evaluateAnswer(userRequest); break;
		case YesNo: resp = evaluateYesNo(userRequest); recState = RecognitionState.Answer; break;
		default: resp = response("Erkannter Text: " + userRequest);
		}   
		return resp;
	}

	private SpeechletResponse evaluateYesNo(String userRequest) {
		SpeechletResponse res = null;
		recognizeUserIntent(userRequest);
		switch (ourUserIntent) {
		case Yes: {
			selectQuestion();
			res = askUserResponse(question); break;
		} case No: {
			res = response(buildString(sumMsg, String.valueOf(sum), "")+" "+goodbyeMsg); break;
		} default: {
			res = askUserResponse(errorYesNoMsg);
		}
		}
		return res;
	}


	private SpeechletResponse evaluateAnswer(String userRequest) {
		SpeechletResponse res = null;
		recognizeUserIntent(userRequest);
		switch (ourUserIntent) {
		case Publikum: {
			if (publikumUsed) {
				res = askUserResponse(publikumUsedMsg);
			} else {
				publikumUsed = true;
				usePublikumJoker();
				res = askUserResponse(buildString(publikumAnswerMsg, answerOption1, answerOption2));
			}
		}; break; 
		case FiftyFifty: {
			if (fiftyfiftyUsed) {
				res = askUserResponse(fiftyfiftyUsedMsg);
			} else {
				fiftyfiftyUsed = true;
				useFiftyFiftyJoker();
				res = askUserResponse(buildString(fiftyfiftyAnswerMsg, answerOption1, answerOption2));
			}
		}; break; 
		default :{
			if (ourUserIntent.equals(UserIntent.A) 
					|| ourUserIntent.equals(UserIntent.B)
					|| ourUserIntent.equals(UserIntent.C)
					|| ourUserIntent.equals(UserIntent.D)	
					) {
				logger.info("User answer ="+ ourUserIntent.name().toLowerCase()+ "/correct answer="+correctAnswer);
				if (ourUserIntent.name().toLowerCase().equals(correctAnswer)) {
					logger.info("User answer recognized as correct.");
					increaseSum();
					if (sum == 1000000) {
						res = response(correctMsg+" "+congratsMsg+" "+goodbyeMsg);
					} else {
						recState = RecognitionState.YesNo;
						res = askUserResponse(correctMsg+" "+continueMsg);
					}
				} else {
					setfinalSum();
					res = response(wrongMsg+ " "+ sumMsg + " " +goodbyeMsg);
				}
			} else {
				res = askUserResponse(errorAnswerMsg);
			}
		}
		}
		return res;
	}

	private void setfinalSum() {
		if (sum <500){
			sum = 0;
		}else{
			if(sum <16000){
				sum = 500;
			}else{
				sum=16000;
			}
		}

	}

	private void increaseSum() {
		switch(sum){
		case 0: sum = 50; break;
		case 50: sum = 100; break;
		case 100: sum = 200; break;
		case 200: sum = 300; break;
		case 300: sum = 500; break;
		case 500: sum = 1000; break;
		case 1000: sum = 2000; break;
		case 2000: sum = 4000; break;
		case 4000: sum = 8000; break;
		case 8000: sum = 16000; break;
		case 16000: sum = 32000; break;
		case 32000: sum = 64000; break;
		case 64000: sum = 125000; break;
		case 125000: sum = 500000; break;
		case 500000: sum = 1000000; break;
		}
	}
	void recognizerUserIntent(String userRequest) {
		userRequest = userRequest.toLowerCase();
		
		// room
		String leave ="(I want to)? (I would like to)? leave |exit *)";
		String search ="(I want to)? (I would like to)? search | look ";
		String whitness ="(I want to)? (I would like to)? ask | talk *";
		String where = "Where|place (have you been)? when (the crime was committed?)?";
		String relationship ="(what was your)? (Did you) relationship|like|hate|love (the lord)?";
		String weird =" (Did something seem)? weird (to you lately)?";
		String suspicion="(Do you have any) suspicion";
		String others="(could you imagine)? others committing (such a)? crime";
		String anythingelse ="(i would like to hear| ask)? anything else";
		
		//allgemein
		String nein = "\bnein\b";
		String ja = "\bja\b";
		String start = "(i would like to)? play(please)?";
		String endgame="(i would like to)?end game (please)?";
		
		
		//solving Vorgang
		String solve= "(I would like to)? solve | answer| solution (the mystery)?";
		String solvebutler ="(it was the)? (the murderer is the) butler";
		String solvechild ="(it was the)? (the murderer is the) child";
		String solvemaid ="(it was the)? (the murderer is the) maid";
		String solvegardener="(it was the)? (the murderer is the) gardener";
		String solvecook="(it was the)? (the murderer is the) cook";
		String solvelady="(it was the)? (the murderer is the) lady";
		String breakupsolving="(i want to) break up solving";
		
		//watson
		String watson = "(i would like to)? (ask)? watson(please)?";
		String askzsmfassung= "(i would like to hear)? (a|the)? summary (please)?";
		String askvokabeln ="(please)? translate|(what)? means the word|what is|vocabulary (can you tell me)?";
		String examplequestions="(I would like to hear | listen)? example questions";
		
		//manual
		String manual ="(please)? explain| manual";
		String repeatmanual ="(Can you)? repeat | manual";
		
		Pattern p1 = Pattern.compile(leave);
		Matcher m1 = p1.matcher(userRequest);
		Pattern p2 = Pattern.compile(search);
		Matcher m2 = p2.matcher(userRequest);
		Pattern p3 = Pattern.compile(whitness);
		Matcher m3 = p3.matcher(userRequest);
		Pattern p4 = Pattern.compile(where);
		Matcher m4 = p4.matcher(userRequest);
		Pattern p5 = Pattern.compile(relationship);
		Matcher m5 = p5.matcher(userRequest);
		Pattern p6 = Pattern.compile(weird);
		Matcher m6 = p6.matcher(userRequest);
		Pattern p7 = Pattern.compile(suspicion);
		Matcher m7 = p7.matcher(userRequest);
		Pattern p8 = Pattern.compile(others);
		Matcher m8 = p8.matcher(userRequest);
		Pattern p9 = Pattern.compile(anythingelse);
		Matcher m9 = p9.matcher(userRequest);
		Pattern p10 = Pattern.compile(nein);
		Matcher m10 = p10.matcher(userRequest);
		Pattern p11 = Pattern.compile(ja);
		Matcher m11 = p11.matcher(userRequest);
		Pattern p12 = Pattern.compile(start);
		Matcher m12 = p12.matcher(userRequest);
		Pattern p13 = Pattern.compile(endgame);
		Matcher m13 = p13.matcher(userRequest);
		Pattern p14 = Pattern.compile(solve);
		Matcher m14 = p14.matcher(userRequest);
		Pattern p15 = Pattern.compile(solvebutler);
		Matcher m15 = p15.matcher(userRequest);
		Pattern p16 = Pattern.compile(solvemaid);
		Matcher m16 = p16.matcher(userRequest);
		Pattern p17 = Pattern.compile(solvechild);
		Matcher m17 = p17.matcher(userRequest);
		Pattern p18 = Pattern.compile(solvegardener);
		Matcher m18 = p18.matcher(userRequest);
		Pattern p19 = Pattern.compile(solvecook);
		Matcher m19 = p19.matcher(userRequest);
		Pattern p20 = Pattern.compile(solvelady);
		Matcher m20 = p20.matcher(userRequest);
		Pattern p21 = Pattern.compile(breakupsolving);
		Matcher m21 = p21.matcher(userRequest);
		Pattern p22 = Pattern.compile(watson);
		Matcher m22 = p22.matcher(userRequest);
		Pattern p23 = Pattern.compile(askzsmfassung);
		Matcher m23 = p23.matcher(userRequest);
		Pattern p24 = Pattern.compile(examplequestions);
		Matcher m24 = p24.matcher(userRequest);
		Pattern p25 = Pattern.compile(manual);
		Matcher m25 = p25.matcher(userRequest);
		Pattern p26 = Pattern.compile(repeatmanual);
		Matcher m26 = p26.matcher(userRequest);
		
		
		
		public static void start() { 									//startfunktion erkennerknoten
			
			if (m12.find()) {
				ourUserIntent =UserIntent.startgame;
			}
			
		}
		
		
		public static void manual () {										//entweder wird das manual erklärt oder direkt zur eingangshalle weitergeleitet
																			// yes oder no noch reinbringen
			if (m25.find()){
				OurUserIntent =UserIntent. //manual function;
			}
			else(){
				//funktion eingangshalle
			}
		}
		
		
		public static void room(){
			if(m1.find()) {
				OurUserIntent =UserIntent.//funktion leave the room;
			}
			else if (m2.find()) {
				OurUserIntent =UserIntent.//funktion search the room;
			}
			
			else if (m3.find()) {
				OurUserIntent=UserIntent.//whitness befragen funktion;
			}
				
			
			
			
			
	
		
		
		
		if (m1.find()) {
		
		} else if (m2.find()) {
			ourUserIntent = UserIntent.Publikum;
		} else if (m3.find()) {
			ourUserIntent = UserIntent.FiftyFifty;
		} else if (m4.find()) {
			ourUserIntent = UserIntent.No;
		} else if (m5.find()) {
			ourUserIntent = UserIntent.Yes;
		}
		logger.info("set ourUserIntent to " +ourUserIntent);
	}

		}
		
	 void recognizeUserIntent(String userRequest) {
		userRequest = userRequest.toLowerCase();
		String pattern1 = "(ich nehme )?(antwort )?(\\b[a-d]\\b)( bitte)?";
		String pattern2 = "(ich nehme )?(den )?publikumsjoker( bitte)?";
		String pattern3 = "(ich nehme )?(den )?(fiftyfifty|fÃ¼nfzigfÃ¼nfzig) joker( bitte)?";
		String pattern4 = "\bnein\b";
		String pattern5 = "\bja\b";
		
		Pattern p1 = Pattern.compile(pattern1);
		Matcher m1 = p1.matcher(userRequest);
		Pattern p2 = Pattern.compile(pattern2);
		Matcher m2 = p2.matcher(userRequest);
		Pattern p3 = Pattern.compile(pattern3);
		Matcher m3 = p3.matcher(userRequest);
		Pattern p4 = Pattern.compile(pattern4);
		Matcher m4 = p4.matcher(userRequest);
		Pattern p5 = Pattern.compile(pattern5);
		Matcher m5 = p5.matcher(userRequest);
		if (m1.find()) {
			String answer = m1.group(3);
			switch (answer) {
			case "a": ourUserIntent = UserIntent.A; break;
			case "b": ourUserIntent = UserIntent.B; break;
			case "c": ourUserIntent = UserIntent.C; break;
			case "d": ourUserIntent = UserIntent.D; break;
			}
		} else if (m2.find()) {
			ourUserIntent = UserIntent.Publikum; //welche funktionen?
		} else if (m3.find()) {
			ourUserIntent = UserIntent.FiftyFifty;
		} else if (m4.find()) {
			ourUserIntent = UserIntent.No;
		} else if (m5.find()) {
			ourUserIntent = UserIntent.Yes;
		}
		logger.info("set ourUserIntent to " +ourUserIntent);
	}

	//TODO
	private void useFiftyFiftyJoker() {
		answerOption1 = correctAnswer;
		answerOption2 = correctAnswer;
	}

	//TODO
	private void usePublikumJoker() {
		answerOption1 = correctAnswer;
	}

	/**
	 * formats the text in weird ways
	 * @param text
	 * @param i
	 * @return
	 */
	private SpeechletResponse responseWithFlavour(String text, int i) {

		SsmlOutputSpeech speech = new SsmlOutputSpeech();
		switch(i){ 
		case 0: 
			speech.setSsml("<speak><amazon:effect name=\"whispered\">" + text + "</amazon:effect></speak>");
			break; 
		case 1: 
			speech.setSsml("<speak><emphasis level=\"strong\">" + text + "</emphasis></speak>");
			break; 
		case 2: 
			String half1=text.split(" ")[0];
			String[] rest = Arrays.copyOfRange(text.split(" "), 1, text.split(" ").length);
			speech.setSsml("<speak>"+half1+"<break time=\"3s\"/>"+ StringUtils.join(rest," ") + "</speak>");
			break; 
		case 3: 
			String firstNoun="erstes Wort buchstabiert";
			String firstN=text.split(" ")[3];
			speech.setSsml("<speak>"+firstNoun+ "<say-as interpret-as=\"spell-out\">"+firstN+"</say-as>"+"</speak>");
			break; 
		case 4: 
			speech.setSsml("<speak><audio src='soundbank://soundlibrary/transportation/amzn_sfx_airplane_takeoff_whoosh_01'/></speak>");
			break;
		default: 
			speech.setSsml("<speak><amazon:effect name=\"whispered\">" + text + "</amazon:effect></speak>");
		} 

		return SpeechletResponse.newTellResponse(speech);
	}


	@Override
	public void onSessionEnded(SpeechletRequestEnvelope<SessionEndedRequest> requestEnvelope)
	{
		logger.info("Alexa session ends now");
	}



	/**
	 * Tell the user something - the Alexa session ends after a 'tell'
	 */
	private SpeechletResponse response(String text)
	{
		// Create the plain text output.
		PlainTextOutputSpeech speech = new PlainTextOutputSpeech();
		speech.setText(text);

		return SpeechletResponse.newTellResponse(speech);
	}

	/**
	 * A response to the original input - the session stays alive after an ask request was send.
	 *  have a look on https://developer.amazon.com/de/docs/custom-skills/speech-synthesis-markup-language-ssml-reference.html
	 * @param text
	 * @return
	 */
	private SpeechletResponse askUserResponse(String text)
	{
		SsmlOutputSpeech speech = new SsmlOutputSpeech();
		speech.setSsml("<speak>" + text + "</speak>");

		// reprompt after 8 seconds
		SsmlOutputSpeech repromptSpeech = new SsmlOutputSpeech();
		repromptSpeech.setSsml("<speak><emphasis level=\"strong\">Hey!</emphasis> Bist du noch da?</speak>");

		Reprompt rep = new Reprompt();
		rep.setOutputSpeech(repromptSpeech);

		return SpeechletResponse.newAskResponse(speech, rep);
	}


}
